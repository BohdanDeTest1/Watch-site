<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Конфигуратор</title>
    <link rel="stylesheet" href="QueryCreator.css">
</head>

<body>

    <header class="container">
        <h1>Query Creator</h1>
        <h3>Moonactive</h3>
        <p class="muted">
            Paste (Cmd+V) the copied table from Google Sheets
            The columns <strong>Event</strong> and <strong>Property</strong> will be detected automatically
        </p>
    </header>

    <main class="container grid">
        <section class="card">
            <h2>1. Analytics table input</h2>
            <label class="label">Data from the Google Sheets with analytics requirements</label>
            <textarea id="pasteArea" placeholder="Paste the rows here (usually TSV from Google Sheets)"></textarea>

            <div class="row">
                <div class="field">
                    <div class="field">
                        <label class="label">Table</label>
                        <select id="tableEnv">
                            <option value="stage">Stage / RC</option>
                            <option value="prod">Production</option>
                        </select>
                    </div>
                </div>
                <div class="field">
                    <label class="label">Generation mode</label>
                    <select id="mode">
                        <option value="property_in">SELECT event ...</option>
                        <option value="distinct_props">SELECT DISTINCT event ...</option>
                    </select>
                </div>
            </div>

            <!-- ↓↓↓ Новый блок Дата ↓↓↓ -->
            <div class="row" id="dateRow">
                <div class="field">
                    <label class="label">Date</label>

                    <div class="date-col">
                        <!-- Линия 1: Сегодня -->
                        <label class="date-option">
                            <input type="radio" name="dateMode" id="dateModeToday" checked>
                            Today <span id="todayText" class="chip-date"></span>
                        </label>


                        <!-- Линия 2: Диапазон + поля дат в своей строке -->
                        <div class="date-option">
                            <label class="inline">
                                <input type="radio" name="dateMode" id="dateModeRange">
                                Range
                            </label>

                            <div class="date-range" id="dateRangeWrap" style="display:none;">
                                <input type="date" id="dateStart" style="max-width:180px;">
                                <input type="date" id="dateEnd" style="max-width:180px;">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ↑↑↑ Новый блок Дата ↑↑↑ -->


            <div class="row">
                <button id="parseBtn">Table decompose</button>
                <button id="refreshBtn" class="btn-refresh">Refresh</button>
            </div>
            <div id="errorBox" class="hidden"></div>
            <div id="infoBox" class="hidden"></div>
            <span id="parseStatus" class="muted small"></span>

            <div id="eventPicker" class="row" style="display:none;">
                <div class="field">
                    <label class="label">Events</label>
                    <!-- multiple + высота списка -->
                    <select id="eventSelect" multiple size="8"></select>
                    <label class="label" style="margin-top:8px; display:flex; gap:8px; align-items:center;">
                        <input type="checkbox" id="selectAllEvents"> Select all
                    </label>
                </div>
                <button id="genBtn">SQL generating</button>
            </div>

        </section>

        <section class="card">
            <h2>2. Generated query</h2>
            <label class="label">SQL query</label>
            <textarea id="sqlOutput" readonly placeholder="SQL will appear here"></textarea>
            <div class="row">
                <button id="copyBtn">Copy</button>
                <span id="copyStatus" class="muted"></span>
            </div>

            <details class="help">
                <summary>How it works?</summary>
                <ol>
                    <li>Copy the rows from Google Sheets (they come in as TSV - tab-separated)</li>
                    <li>Click “Parse table” - the script will find the <em>Event</em> and <em>Property</em> columns
                        (case insensitive)</li>
                    <li>Select the desired Event and click “Generate SQL”</li>
                </ol>
            </details>
        </section>
    </main>

    <footer class="container muted small">
        v.1.01 - 2025
    </footer>
    <script src="QueryCreator.js"></script>
</body>

</html>